<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Advanced - Pose Editor</title>
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body data-theme="dark">

<div class="theme-toggle">
    <label class="switch">
        <input type="checkbox" id="themeSwitch">
        <span class="slider"></span>
    </label>
    <span class="theme-label">Dark Mode</span>
</div>

<div class="container">
    <h1>Advanced Editor</h1>
    <p class="subtitle">Load a .pose file and edit metadata fields directly.</p>
    <form id="advancedForm" action="/process_advanced" method="post" enctype="multipart/form-data" class="card">
        <div style="margin-bottom:12px; text-align:center;">
            <a class="green-btn" href="/">Simple Editor</a>
        </div>
        <label>Upload .pose file (required)</label>
        <div class="file-row">
            <input id="advPoseFile" type="file" name="pose_file" accept=".pose,application/json" required>
            <button type="button" id="clearAdvPose" class="clear-btn">Clear</button>
        </div>
        <p class="note">Max pose file size: 100 MB</p>

        <!-- Always-visible link back to Simple Editor -->

        <!-- Resize row hidden until a JSON .pose is loaded (moved below the image preview) -->
        <div id="advancedControls" style="display:none">
            <label>Author</label>
            <div class="field-with-counter">
                <input id="authorInput" type="text" maxlength="50" placeholder="Author name (max 50)">
                <span class="counter counter-inset counter-inset-input" id="authorCounter">0/50</span>
            </div>

            <label>Description</label>
            <div class="field-with-counter">
                <textarea id="descInput" rows="3" maxlength="160" placeholder="Description (max 160)"></textarea>
                <span class="counter counter-inset" id="descCounter">0/160</span>
            </div>

            <label>Version</label>
            <div class="field-with-counter">
                <input id="versionInput" type="text" maxlength="10" placeholder="Version (max 10)">
                <span class="counter counter-inset counter-inset-input" id="verCounter">0/10</span>
            </div>

            <label>Tags</label>
            <p>Tags are currently disabled due to a bug within brio.
                This field will reappear once the bug has been resolved.
                You can click the green tag (if visible) to remove them if you pose contains them.</p>
            <div class="field-with-counter">
                <div class="tag-input-row">



                    <!-- TODO: re-enable tags once brio bug is fixed
                    <input id="tagInput" type="text" placeholder="Press Space or Enter to add a tag. Click a tag to remove it.">
                    -->



                </div>
                <span class="counter counter-inset counter-inset-input" id="tagCounter">0/50</span>
            </div>
            <div id="tagList" class="tag-list"></div>


            <label>Image Preview</label>
            <div class="image-preview-box">
                <img id="imagePreview" src="" alt="No image" style="display:none; max-width:100%; height:auto; border-radius:8px;">
                <div id="noImagePlaceholder" class="no-image">No preview</div>
            </div>
            <p class="note" style="text-align:center; margin-top:8px;">Recommended: use square (1:1) images for best results.</p>
            <div class="file-row" style="margin-top:8px;">
                <input id="replaceImageInput" type="file" name="image_file" accept="image/*">
                <button type="button" id="clearReplaceImage" class="clear-btn">Clear</button>
            </div>

            <!-- Resize selector moved here and hidden until load -->
            <div id="resizeRow" style="display:none; margin-top:8px;">
                <label>Thumbnail size</label>
                <select id="advResize" name="resize">
                    <option value="none">No scaling (keep original)</option>
                    <option value="1440">1440p</option>
                    <option value="1080">1080p</option>
                    <option value="720" selected>720p (recommended)</option>
                    <option value="480">480p</option>
                </select>
            </div>

            <div style="display:flex; gap:12px; margin-top:18px;">
                <button id="createBtn" type="button">Create</button>
                <button id="startOverBtn" type="button" class="danger">Start over</button>
            </div>

            <div id="errorBanner" class="error-banner" style="display:none"></div>

            <!-- Hidden field to send minimal changes; populated by JS just before submit -->
            <input type="hidden" name="changes" id="changesField">
        </div>
            <div class="social-buttons" style="margin-top:12px;">
                <a class="social-btn" id="discordBtn" href="{{ discord_url }}" target="_blank" rel="noopener noreferrer">
                    <img src="{{ url_for('static', filename='discord.webp') }}" alt="Discord">
                    <span>Discord</span>
                </a>
                <a class="social-btn" id="githubBtn" href="{{ github_url }}" target="_blank" rel="noopener noreferrer">
                    <img src="{{ url_for('static', filename='github.webp') }}" alt="GitHub">
                    <span>GitHub</span>
            </a>
        </div>
    </form>

    <div class="center">
        <p class="subtitle">Made by Tex Nevada - {{ version }}</p>
    </div>
</div>

<script>
    // Theme toggle reuse
    const switchEl = document.getElementById("themeSwitch");
    const body = document.body;
    switchEl.checked = true;
    switchEl.addEventListener("change", () => {
        if (switchEl.checked) {
            body.setAttribute("data-theme", "dark");
            document.querySelector(".theme-label").innerText = "Dark Mode";
        } else {
            body.setAttribute("data-theme", "light");
            document.querySelector(".theme-label").innerText = "Light Mode";
        }
    });
</script>

<script src="{{ url_for('static', filename='advanced.js') }}"></script>
</body>
</html>
