<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Advanced - Pose Editor</title>
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="{{ url_for('static', filename='advanced.js') }}" defer></script>
    {% include "open-graph-meta-tags.html" %}
</head>
<body data-theme="dark">

<div class="theme-toggle">
    <label class="switch">
        <input type="checkbox" id="themeSwitch">
        <span class="slider"></span>
    </label>
    <span class="theme-label">Dark Mode</span>
</div>

<div class="container">
    {% include "container-header.html" %}
    <form id="advancedForm" action="/process_advanced" method="post" enctype="multipart/form-data" class="card">
        <h2 style="text-align:center;">Advanced Editor</h2>
        <p class="subtitle" style="text-align:center;">Load a .pose file and edit metadata fields directly.</p>
        <div style="margin-bottom:12px; text-align:center;">
            <a class="green-btn" href="/">Simple Editor</a>
        </div>
        <label>Upload .pose file (required)</label>
        <div class="file-row">
            <input id="advPoseFile" type="file" name="pose_file" accept=".pose,application/json" required>
            <button type="button" id="clearAdvPose" class="clear-btn">Clear</button>
        </div>
        <p class="note">Max pose file size: 10 MB</p>

        <!-- Resize row hidden until a JSON .pose is loaded (moved below the image preview) -->
        <div id="advancedControls" style="display:none">
            <label>Author</label>
            <div class="field-with-counter">
                <input id="authorInput" type="text" maxlength="50" placeholder="Author name (max 50)">
                <span class="counter counter-inset counter-inset-input" id="authorCounter">0/50</span>
            </div>

            <label>Description</label>
            <div class="field-with-counter">
                <textarea id="descInput" rows="3" maxlength="160" placeholder="Description (max 160)"></textarea>
                <span class="counter counter-inset" id="descCounter">0/160</span>
            </div>

            <label>Version</label>
            <div class="field-with-counter">
                <input id="versionInput" type="text" maxlength="10" placeholder="Version (max 10)">
                <span class="counter counter-inset counter-inset-input" id="verCounter">0/10</span>
            </div>

            <label>Tags</label>
            <div class="field-with-counter">
                <div class="tag-input-row">
                    <input id="tagInput" type="text" placeholder="Press Space or Enter to add a tag. Click a tag to remove it.">
                </div>
                <span class="counter counter-inset counter-inset-input" id="tagCounter">0/50</span>
            </div>
            <div id="tagList" class="tag-list"></div>


            <label>Image Preview</label>
            <div class="image-preview-box">
                <img id="imagePreview" src="" alt="No image" style="display:none; max-width:100%; height:auto; border-radius:8px;">
                <div id="noImagePlaceholder" class="no-image">No preview</div>
            </div>
            <p class="note" style="text-align:center; margin-top:8px;">Recommended: use square (1:1) images for best results.</p>
            <div class="file-row" style="margin-top:8px;">
                <input id="replaceImageInput" type="file" name="image_file" accept="image/*">
                <button type="button" id="clearReplaceImage" class="clear-btn">Clear</button>
            </div>

            <!-- Resize selector moved here and hidden until load -->
            <div id="resizeRow" style="display:none; margin-top:8px;">
                {% include "form-image-resizer.html" %}
            </div>

            <div style="display:flex; gap:12px; margin-top:18px;">
                <button id="createBtn" type="button">Create</button>
                <button id="startOverBtn" type="button" class="danger">Start over</button>
            </div>

            <div id="errorBanner" class="error-banner" style="display:none"></div>

            <!-- Hidden field to send minimal changes; populated by JS just before submit -->
            <input type="hidden" name="changes" id="changesField">
        </div>

        {% include "container-footer.html" %}

    </form>

    <div class="center">
        <p class="subtitle">Made by Tex Nevada - {{ version }}</p>
    </div>
</div>

{% include "theme-selector.html" %}


</body>
</html>
